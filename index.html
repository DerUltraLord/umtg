<!DOCTYPE html>
<html>
    <head>
        <title>Ultra Magic The Gathering</title>

        <script>
            if (typeof module === 'object') { window.module = module; module = undefined; }
        </script>

        <script>
            window.$ = window.jQuery = require('jquery');
            window.Bootstrap = require('bootstrap');
            var riot = require('riot');
            var events = riot.observable();
            var db = require('./src/db.js');
            var deck = require('./src/deck.js');
            var scry = require('./src/scryfall.js');
            var base = require('./src/base.js');
            var settings = require('./src/settings.js');
        </script>

        <script> if (window.module) module = window.module; </script>

        <link rel="stylesheet" href="src/style.css" ></link>
        <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="node_modules/open-iconic/font/css/open-iconic-bootstrap.css">
    </head>

    <body>
        <navigation pages="{state.pages}"></navigation>

        <div style="background-color: yellow">
            <search-page show="{state.currentPage=='search'}" ></search-page>
            <collection-page show="{state.currentPage=='collection'}"></collection-page>
            <decks-page show="{state.currentPage=='decks'}"></decks-page>
            <settings-page show="{state.currentPage=='settings'}"></settings-page>
            <about-page show="{state.currentPage=='about'}"></settings-page>
        </div>


        <umtg-footer></umtg-footer>
        <script src="src/tags/all.js"></script>

        <script>
            var state = {
                'pages': ["search", "collection", "decks", "settings", "about"],
                'currentPage': "search",
                'pageInstances': {
                    "search": null,
                    "collection": null,
                    "decks": null,
                    "settings": null,
                    "about": null,
                }

            }

            settings.init()
            .then(() => {
                db.init('test.db');

                function onPageSelected(page) {
                    var oldPage = state.pageInstances[state.currentPage];
                    state.currentPage = page;
                    oldPage.update();
                    state.pageInstances[page].update();
                }

                riot.mount('card-list');
                state.pageInstances['search'] = riot.mount('search-page')[0];
                state.pageInstances['collection'] = riot.mount('collection-page')[0];
                state.pageInstances['decks'] = riot.mount('decks-page')[0];
                state.pageInstances['settings'] = riot.mount('settings-page')[0];
                state.pageInstances['about'] = riot.mount('about-page')[0];
                riot.mount('deck-add-buttons');
                riot.mount('umtg-footer');
                riot.mount('navigation', { onPageSelected: onPageSelected });
            });
        </script>
    </body>
</html>
